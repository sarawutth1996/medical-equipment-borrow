"use strict";function sidebarRun(t,e,n,o,r){function a(e){t.sidebarVisible=angular.isDefined(e)?e:!t.sidebarVisible}t.layout=function(){return t.sidebarVisible?"sidebar-visible":""},t.toggleSidebar=a,t.closeSidebar=function(){a(!1)},n.on("keyup",function(e){27==e.keyCode&&o(function(){a(!1)})}),e.innerWidth<r.desktop&&o(function(){a(!1)})}function coreConfig(e){e.addStrategy("price",{numInt:7,numSep:".",numPos:!0,numNeg:!1,numRound:"round",numThousand:!0,numThousandSep:","}),e.addStrategy("priceShow",{numFixed:!0,numSep:".",numPos:!0,numNeg:!1,numRound:"round",numThousand:!0,numThousandSep:","})}function coreRun(a,i,e,t,n,o){if(e.CRM){var r={mod:"check_active",it:e.CRM};t.post("server/models/login.php",r).then(function(e){e.data.status?n.set(e.data.keep):(n.clear(),o.listen())},function(e){console.error(e)})}else a.globals={},o.listen();a.$on("$locationChangeStart",function(e,t,n){if(a.globals){var o="/login/"!==i.path().substr(0,7),r=a.globals.auth;o&&!r&&i.path("/login/")}})}function coreService(n,o,r,t,a){var e={set:function(e){var t=(n.globals=e).profile.role;o.definePermission(t,function(){return!0}),e.auth?r.CRM=e.auth:(n.globals.auth=r.CRM,a.sync(),a.listen())},clear:function(){var e=n.globals.profile.comp;n.globals={},delete r.CRM,o.clearStore(),t.path("/login/"+e)}};return e}function routerConfig(e,t,n,o){n.hashPrefix(""),t.otherwise("/v0.1/customerService/ticket"),t.deferIntercept(),o.suppressUndefinedPermissionWarning(!0);var r="app/";e.state("login",{url:"/login/:cm",templateUrl:r+"login.html",controller:"loginController as vm"}).state("error",{url:"/error",templateUrl:r+"error.html"}).state("app",{url:"/v0.1",abstract:!0,templateUrl:r+"core.layout.html"}).state("app.setting",{url:"/setting",templateUrl:r+"setting.html",controller:"settingController as vm"}).state("app.home",{url:"/home",templateUrl:r+"home.html",controller:"homeController as vm"})}function routerRun(e,t,n){e.$state=t,e.$stateParams=n,e.$on("$stateChangeSuccess",function(e,t,n,o,r){var a;(a=document.querySelector("main"))&&(a.scrollTop=0)}),e.$on("$stateNotFound",function(e,t){console.error("State not found: "+t.to+t.toParams+t.options)}),e.$on("$stateChangeError",function(e,t,n,o,r,a){console.error(a)}),t.defaultErrorHandler(function(e){console.error(e)})}function loadingbarConfig(e){e.includeBar=!0,e.includeSpinner=!1,e.latencyThreshold=500}function loadingbarRun(e,t,n){var o;e.$on("$stateChangeStart",function(){o=t(function(){n.start()},0)}),e.$on("$stateChangeSuccess",function(e){e.targetScope.$watch("$viewContentLoaded",function(){t.cancel(o),n.complete()})})}function preloader(s,c,u){return{restrict:"EAC",template:'<div class="preloader-progress"><div class="preloader-progress-bar" ng-style="{width: loadCounter + \'%\'}"></div></div>',link:function(n,e){function t(){c.cancel(l),n.loadCounter=100,c(function(){s.addClass(e,"preloader-hidden"),angular.element("body").css("overflow","")},300)}var o,r,a,i=n.loadCounter=0,l=void 0;angular.element("body").css("overflow","hidden"),e.addClass("preloader"),(o=u.defer(),r=0,a=n.$on("$viewContentLoaded",function(){1<++r&&(o.resolve(),a())}),o.promise).then(function(){c(t,500)}),l=c(function e(){var t=100-i;i+=.0175*Math.pow(1-Math.sqrt(t),2),n.loadCounter=parseInt(i,10),l=c(e,20)})}}}function loading(){return{restrict:"E",scope:{showLoading:"=?"},template:'<div class="loading" ng-show="showLoading"><div class="backdrop"></div><div class="loader-box"><div class="loader"></div></div></div>'}}function ripple(){return{restrict:"C",link:function(e,t){new Ripple(t)}}}function ngEnter(){return function(t,e,n){e.bind("keydown keypress",function(e){13===e.which&&(t.$apply(function(){t.$eval(n.ngEnter,{event:e})}),e.preventDefault())})}}function svgReplace(r,a,i,e){return{restrict:"A",replace:!0,link:function(n,o,t){e(function(){var e=t.src;if(!e||e.indexOf(".svg")<0)throw"only support for SVG images";a.get(e,{cache:i}).then(function(e){var t=r(e.data)(n);o.replaceWith(t)})})}}}function showPassword(){return function(e,n,t){e.$watch(t.showPassword,function(e){var t=e?"text":"password";n.attr("type",t)})}}function loginController(t,n,o,r,a){function i(){r.swal({text:"กรุณากรอกรหัสบริษัท",type:"warning",confirmButtonText:"ตกลง",allowOutsideClick:!1})}var l=this;""===a.cm&&i(),l.checkValid=function(e,t){var n="";if(e)switch(!t){case!0:n="border-valid";break;case!1:n="border-invalid"}return n},l.login=function(){if(""!==a.cm){var e={mod:"login",it:{us:l.user,pw:l.pass,comp:a.cm}};t.post("server/models/login.php",e).then(function(e){if("Okkk"===e.data.status)o.set(e.data.keep),n.go("app.cust_service.ticket");else{var t="falUP"===e.data.status?"Username หรือ Password ไม่ถูกต้อง":"User ถูกระงับการใช้งาน";r.swal({text:t,type:"error",confirmButtonText:"ตกลง",allowOutsideClick:!1})}},function(e){console.error(e)})}else i()}}function HeaderController(e){var t=this;t.logout=function(){e.clear()},t.changeCH=function(e){t.channel=e}}function MenuController(){this.menuItem=[{name:"บริการหลังการขาย",items:[{name:"ข้อมูลปัญหา",sref:"app.cust_service.ticket",icon:"ion-ios-analytics"},{name:"แจ้งปัญหา",sref:"app.cust_service.ticket_add",pms:["USER","ADMIN","SUPER_ADMIN"],icon:"ion-md-bulb"},{name:"รายงานปัญหา",icon:"ion-ios-paper",sref:"app.cust_service.report",subitems:[{name:"- ตามเอกสาร",sref:"app.cust_service.report.prob"},{name:"- สรุปรายปี",sref:"app.cust_service.report.prob_year"}]}]},{name:"ผู้จัดการระบบ",pms:"SUPER_ADMIN",items:[{name:"ข้อมูลบัญชีผู้ใช้",sref:"app.admin.manage_user",icon:"ion-md-add-circle"},{name:"ข้อมูลระบบ",sref:"app.admin.prod",icon:"ion-md-add-circle-outline"},{name:"ข้อมูลระบบย่อย",sref:"app.admin.module",icon:"ion-md-add-circle"},{name:"ข้อมูลบริษัท",sref:"app.admin.cust",icon:"ion-md-add-circle-outline"}]}]}function sidebarNav(){return{restrict:"EAC",link:function(e,t){t.on("click",function(e){var t,n,o=(t=e.target,n=t.parentNode,"a"===t.tagName.toLowerCase()?t:"a"===n.tagName.toLowerCase()?n:"a"===n.parentNode.tagName.toLowerCase()?n.parentNode:void 0);if(o){var r=angular.element(o),a=r.parent()[0],i=r.parent().parent().children();i.find("li").removeClass("active"),angular.forEach(i,function(e){e!==a&&angular.element(e).removeClass("active")});var l=r.next();l.length&&"UL"===l[0].tagName&&(r.parent().toggleClass("active"),e.preventDefault())}})}}}function settingController(n,o,r){function a(e){i.data[e]=angular.copy(t[e])}var i=this,l="server/models/setting.php";i.hide={prof:!0,pass:!1},i.show_password=!1;var t={prof:{title:n.globals.profile.title,name:n.globals.profile.name},pass:{old:"",new1:"",new2:""}};i.data=angular.copy(t),i.clear=a,i.saveProf=function(){n.loading=!0;var e={auth:n.globals.auth,mod:"prof",it:i.data.prof};o.post(l,e).then(function(e){e.data.status?(n.globals.profile.title=i.data.prof.title,n.globals.profile.name=i.data.prof.name,r.swal({text:"บันทึกข้อมูลเรียบร้อย",type:"success",confirmButtonText:"ตกลง",allowOutsideClick:!1})):r.swal({text:"บันทึกข้อมูลล้มเหลว",type:"error",confirmButtonText:"ตกลง",allowOutsideClick:!1}),n.loading=!1},function(e){console.error(e),n.loading=!1})},i.savePass=function(){var e=i.data.pass;if(""!==e.old&&""!==e.new1&&""!==e.new1)if(e.new1===e.new2){n.loading=!0;var t={auth:n.globals.auth,mod:"chPW",it:{old:e.old,new:e.new1}};o.post(l,t).then(function(e){if("Yaa"===e.data.status)a("pass"),r.swal({text:"เปลี่ยนรหัสผ่านเรียบร้อย",type:"success",confirmButtonText:"ตกลง",allowOutsideClick:!1});else{var t="noPW"===e.data.status?"รหัสผ่านเดิมไม่ถูกต้อง":"บันทึกข้อมูลล้มเหลว";r.swal({text:t,type:"error",confirmButtonText:"ตกลง",allowOutsideClick:!1})}n.loading=!1},function(e){console.error(e),n.loading=!1})}else r.swal({text:"รหัสใหม่ไม่เหมือนกัน",type:"warning",confirmButtonText:"ตกลง",allowOutsideClick:!1});else r.swal({text:"กรุณากรอกข้อมูลให้ครบถ้วน",type:"warning",confirmButtonText:"ตกลง",allowOutsideClick:!1})}}function homeController(e){console.log(e),e.loading=!0,this.click=function(){e.loading=!0!==e.loading}}angular.module("app",["app.router","app.core","app.loading","app.utils"]),angular.module("app").run(sidebarRun),sidebarRun.$inject=["$rootScope","$window","$document","$timeout","APP_MEDIAQUERY"],angular.module("app.core",["ngAnimate","ngStorage","ui.bootstrap","cfp.loadingBar","ngSlimScroll","ngTable","19degrees.ngSweetAlert2","dynamicNumber"]),angular.module("app.core").constant("APP_MEDIAQUERY",{desktopLG:1200,desktop:992,tablet:767,mobile:480}),angular.module("app.core").config(coreConfig),coreConfig.$inject=["dynamicNumberStrategyProvider"],angular.module("app.core").run(coreRun),coreRun.$inject=["$rootScope","$location","$localStorage","$http","coreService","$urlRouter"],angular.module("app.core").factory("coreService",coreService),coreService.$inject=["$rootScope","PermPermissionStore","$localStorage","$location","$urlRouter"],angular.module("app.router",["ui.router","ui.router.state.events","permission","permission.ui"]),angular.module("app.router").config(routerConfig),routerConfig.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$permissionProvider"],angular.module("app.router").run(routerRun),routerRun.$inject=["$rootScope","$state","$stateParams"],angular.module("app.loading",[]),angular.module("app.loading").config(loadingbarConfig),loadingbarConfig.$inject=["cfpLoadingBarProvider"],angular.module("app.loading").run(loadingbarRun),loadingbarRun.$inject=["$rootScope","$timeout","cfpLoadingBar"],angular.module("app.loading").directive("preloader",preloader).directive("loading",loading),preloader.$inject=["$animate","$timeout","$q"],angular.module("app.utils",[]),angular.module("app.utils").directive("ripple",ripple),function(e){function t(e){var t=angular.element;this.element=e,this.rippleElement=this.getElement(),this.$rippleElement=t(this.rippleElement);var n=this.detectClickEvent(),o=this;e.on(n,function(){o.$rippleElement.removeClass("md-ripple-animate"),o.calcSizeAndPos(),o.$rippleElement.addClass("md-ripple-animate")}),this.$rippleElement.on("transitionend webkitTransitionEnd",function(){o.$rippleElement.removeClass("md-ripple-animate"),o.rippleElement.style.width=0,o.rippleElement.style.height=0})}(window.Ripple=t).prototype.getElement=function(){var e=this.element[0].querySelector(".md-ripple");return null===e&&((e=document.createElement("span")).className="md-ripple",this.element.append(e)),e},t.prototype.calcSizeAndPos=function(){var e=Math.max(this.element.width(),this.element.height());this.rippleElement.style.width=e+"px",this.rippleElement.style.height=e+"px",this.rippleElement.style.marginTop=-e/2+"px",this.rippleElement.style.marginLeft=-e/2+"px"},t.prototype.detectClickEvent=function(){return/iphone|ipad/gi.test(navigator.appVersion)?"touchstart":"click"}}(),angular.module("app.utils").directive("ngEnter",ngEnter),angular.module("app.utils").directive("svgReplace",svgReplace),svgReplace.$inject=["$compile","$http","$templateCache","$timeout"],angular.module("app.utils").directive("showPassword",showPassword),angular.module("app").controller("loginController",loginController),loginController.$inject=["$http","$state","coreService","sweetAlert","$stateParams"],angular.module("app").controller("HeaderController",HeaderController),HeaderController.$inject=["coreService"],angular.module("app").controller("MenuController",MenuController).directive("sidebarNav",sidebarNav),MenuController.$inject=[],sidebarNav.$inject=[],angular.module("app").controller("settingController",settingController),settingController.$inject=["$rootScope","$http","sweetAlert"],angular.module("app").controller("homeController",homeController),homeController.$inject=["$rootScope"];